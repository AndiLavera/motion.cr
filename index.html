<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.34.0">
<meta name="crystal_docs.project_version" content="master">
<meta name="crystal_docs.project_name" content="motion">


<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>

  <meta id="repository-name" content="motion">
  <title>motion master</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          motion
        </a>
      </h1>

      <span class="project-version">
        master
      </span>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="motion/Motion" data-name="motion">
      <a href="Motion.html">Motion</a>
      
        <ul>
  
  <li class=" " data-id="motion/Motion/Adapters" data-name="motion::adapters">
      <a href="Motion/Adapters.html">Adapters</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/Base" data-name="motion::base">
      <a href="Motion/Base.html">Base</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/Configuration" data-name="motion::configuration">
      <a href="Motion/Configuration.html">Configuration</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/Element" data-name="motion::element">
      <a href="Motion/Element.html">Element</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/Event" data-name="motion::event">
      <a href="Motion/Event.html">Event</a>
      
    </li>
  
  <li class="parent " data-id="motion/Motion/HTML" data-name="motion::html">
      <a href="Motion/HTML.html">HTML</a>
      
        <ul>
  
  <li class=" " data-id="motion/Motion/HTML/AllowedInTags" data-name="motion::html::allowedintags">
      <a href="Motion/HTML/AllowedInTags.html">AllowedInTags</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/AssetHelpers" data-name="motion::html::assethelpers">
      <a href="Motion/HTML/AssetHelpers.html">AssetHelpers</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/Assignable" data-name="motion::html::assignable">
      <a href="Motion/HTML/Assignable.html">Assignable</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/BaseTags" data-name="motion::html::basetags">
      <a href="Motion/HTML/BaseTags.html">BaseTags</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/CatchUnpermittedAttribute" data-name="motion::html::catchunpermittedattribute">
      <a href="Motion/HTML/CatchUnpermittedAttribute.html">CatchUnpermittedAttribute</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/CustomTags" data-name="motion::html::customtags">
      <a href="Motion/HTML/CustomTags.html">CustomTags</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/Engine" data-name="motion::html::engine">
      <a href="Motion/HTML/Engine.html">Engine</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/ForgeryProtectionHelpers" data-name="motion::html::forgeryprotectionhelpers">
      <a href="Motion/HTML/ForgeryProtectionHelpers.html">ForgeryProtectionHelpers</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/HTMLTextHelpers" data-name="motion::html::htmltexthelpers">
      <a href="Motion/HTML/HTMLTextHelpers.html">HTMLTextHelpers</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/InputHelpers" data-name="motion::html::inputhelpers">
      <a href="Motion/HTML/InputHelpers.html">InputHelpers</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/LabelHelpers" data-name="motion::html::labelhelpers">
      <a href="Motion/HTML/LabelHelpers.html">LabelHelpers</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/NumberToCurrency" data-name="motion::html::numbertocurrency">
      <a href="Motion/HTML/NumberToCurrency.html">NumberToCurrency</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/RenderIfDefined" data-name="motion::html::renderifdefined">
      <a href="Motion/HTML/RenderIfDefined.html">RenderIfDefined</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/SelectHelpers" data-name="motion::html::selecthelpers">
      <a href="Motion/HTML/SelectHelpers.html">SelectHelpers</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/SpecialtyTags" data-name="motion::html::specialtytags">
      <a href="Motion/HTML/SpecialtyTags.html">SpecialtyTags</a>
      
    </li>
  
  <li class="parent " data-id="motion/Motion/HTML/TextHelpers" data-name="motion::html::texthelpers">
      <a href="Motion/HTML/TextHelpers.html">TextHelpers</a>
      
        <ul>
  
  <li class=" " data-id="motion/Motion/HTML/TextHelpers/Cycle" data-name="motion::html::texthelpers::cycle">
      <a href="Motion/HTML/TextHelpers/Cycle.html">Cycle</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/TimeHelpers" data-name="motion::html::timehelpers">
      <a href="Motion/HTML/TimeHelpers.html">TimeHelpers</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/HTML/UrlHelpers" data-name="motion::html::urlhelpers">
      <a href="Motion/HTML/UrlHelpers.html">UrlHelpers</a>
      
    </li>
  
  <li class="parent " data-id="motion/Motion/HTML/WithDefaults" data-name="motion::html::withdefaults">
      <a href="Motion/HTML/WithDefaults.html">WithDefaults</a>
      
        <ul>
  
  <li class=" " data-id="motion/Motion/HTML/WithDefaults/OptionMerger" data-name="motion::html::withdefaults::optionmerger(t, v)">
      <a href="Motion/HTML/WithDefaults/OptionMerger.html">OptionMerger</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="motion/Motion/MapMethod" data-name="motion::mapmethod">
      <a href="Motion/MapMethod.html">MapMethod</a>
      
    </li>
  
  <li class="parent " data-id="motion/Motion/Motions" data-name="motion::motions">
      <a href="Motion/Motions.html">Motions</a>
      
        <ul>
  
  <li class=" " data-id="motion/Motion/Motions/Broadcasts" data-name="motion::motions::broadcasts">
      <a href="Motion/Motions/Broadcasts.html">Broadcasts</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="motion/Motion/MountComponent" data-name="motion::mountcomponent">
      <a href="Motion/MountComponent.html">MountComponent</a>
      
    </li>
  
  <li class=" " data-id="motion/Motion/PeriodicTimer" data-name="motion::periodictimer">
      <a href="Motion/PeriodicTimer.html">PeriodicTimer</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p>&lt;p align="center">
  &lt;img src="./images/logo.svg" width="800">
  &lt;p align="center">Reactive, Real-time Frontend Components&lt;/p>
  &lt;p align="center">&lt;a href="http://3.23.28.58/">Try the Motion Demo&lt;/a>&lt;/p>
  &lt;p align="center"></p>

<pre><code><span class="o">&lt;</span>a href<span class="o">=</span><span class="s">&quot;https://www.codacy.com/manual/andrewc910/motion.cr?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=andrewc910/motion.cr&amp;utm_campaign=Badge_Grade&quot;</span><span class="o">&gt;</span><span class="o">&lt;</span>img src<span class="o">=</span><span class="s">&quot;https://app.codacy.com/project/badge/Grade/91df8833c8fd48b3a0397bf51e2c3787&quot;</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="s">/a&gt;
&lt;a href=&quot;https:/</span><span class="s">/github.com/</span>andrewc910<span class="s">/motion.cr/</span>releases<span class="s">&quot;&gt;&lt;img src=&quot;</span>https<span class="n">://</span>img.shields.io<span class="s">/github/</span>release<span class="s">/andrewc910/</span>motion.cr.svg?maxAge<span class="o">=</span><span class="n">360</span><span class="s">&quot;&gt;&lt;/a&gt;
&lt;a href=&quot;</span>https<span class="n">://</span>www.npmjs.com<span class="s">/package/</span>@awcrotwell<span class="s">/motion&quot;&gt;&lt;img alt=&quot;npm&quot; src=&quot;https:/</span><span class="s">/img.shields.io/</span>npm<span class="s">/v/</span>@awcrotwell<span class="s">/motion&quot;&gt;&lt;/</span>a<span class="o">&gt;</span>
<span class="o">&lt;</span>a href<span class="o">=</span><span class="s">&quot;https://github.com/andrewc910/motion.cr/blob/master/LICENSE&quot;</span><span class="o">&gt;</span><span class="o">&lt;</span>img src<span class="o">=</span><span class="s">&quot;https://img.shields.io/github/license/andrewc910/motion.cr.svg&quot;</span><span class="o">&gt;</span><span class="o">&lt;</span><span class="s">/a&gt;
&lt;a href=&quot;#&quot;&gt;&lt;img src=&quot;https:/</span><span class="s">/github.com/</span>andrewc910<span class="s">/motion.cr/</span>workflows<span class="s">/Build/</span>badge.svg<span class="s">&quot;&gt;&lt;/a&gt;
&lt;a href=&quot;</span><span class="c">#&quot;&gt;&lt;img src=&quot;https://github.com/andrewc910/motion.cr/workflows/Docs/badge.svg&quot;&gt;&lt;/a&gt;</span></code></pre>

<p>&lt;/p>
&lt;/p></p>

<p>&lt;p align="center"> 
  &lt;img src="./images/motion-calculator.gif" width="450" />
&lt;/p></p>

<p>Motion is a framework for building reactive, real-time frontend UI components in your Amber application using pure Crystal that are reusable, testable & encapsulated. For brevity, we will call them MotionComponents.</p>

<ul><li>Motion is an Object-Oriented View Layer</li><li>Peacefully coexists with your existing frontend</li><li>Real-time frontend UI updates from frontend user interaction AND server-side updates</li><li>No more frontend models, stores, or syncing; your source of truth is the database you already have</li><li><strong>Write Less Javascript</strong></li></ul>

<h2><a id="table-of-contents" class="anchor" href="#table-of-contents">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Table of Contents</h2>

<ul><li><a href="#table-of-contents" target="_blank">Table of Contents</a></li><li><a href="#installation" target="_blank">Installation</a></li><li><a href="#documentation" target="_blank">Documentation</a></li><li><a href="#component-guide" target="_blank">Component Guide</a></li></ul>

<ul><li><a href="#why-should-i-use-components-" target="_blank">Why should I use components?</a></li></ul>

<pre><code><span class="o">+</span> [<span class="t">Testing</span>](<span class="c">#testing)</span>
<span class="o">+</span> [<span class="t">Data</span> <span class="t">Flow</span>](<span class="c">#data-flow)</span>
<span class="o">+</span> [<span class="t">Standards</span>](<span class="c">#standards)</span></code></pre>

<ul><li><a href="#building-components" target="_blank">Building components</a></li></ul>

<pre><code><span class="o">+</span> [<span class="t">Conventions</span>](<span class="c">#conventions)</span>
<span class="o">+</span> [<span class="t">Quick</span> start](<span class="c">#quick-start)</span>
<span class="o">+</span> [<span class="t">DSL</span> <span class="t">HTML</span> <span class="t">Generation</span>](<span class="c">#dsl-html-generation)</span>
<span class="o">+</span> [<span class="t">ECR</span> <span class="o">&amp;</span> <span class="t">Slang</span>](<span class="c">#ecr---slang)</span>
<span class="o">+</span> [<span class="t">Properties</span>, <span class="t">Props</span> <span class="o">&amp;</span> <span class="t">Type</span> <span class="t">Safety</span>](<span class="c">#properties--props---type-safety)</span>
<span class="o">+</span> [<span class="t">Blocks</span> <span class="o">&amp;</span> <span class="t">Procs</span>](<span class="c">#blocks---procs)</span></code></pre>

<ul><li><a href="#motions-guide" target="_blank">Motions Guide</a></li></ul>

<ul><li><a href="#installation-1" target="_blank">Installation</a></li><li><a href="#building-motions" target="_blank">Building Motions</a></li></ul>

<pre><code><span class="o">+</span> [<span class="t">Frontend</span> interactions](<span class="c">#frontend-interactions)</span>
<span class="o">+</span> [<span class="t">Periodic</span> <span class="t">Timers</span>](<span class="c">#periodic-timers)</span>
<span class="o">+</span> [<span class="t">Backend</span> <span class="t">Interactions</span>](<span class="c">#backend-interactions)</span>
<span class="o">+</span> [<span class="t">Motion</span><span class="t">::</span><span class="t">Event</span> and <span class="t">Motion</span><span class="t">::</span><span class="t">Element</span>](<span class="c">#motionevent-and-motionelement)</span></code></pre>

<ul><li><a href="#configuration" target="_blank">Configuration</a></li></ul>

<ul><li><a href="#redis-backend-for-distributed-systems" target="_blank">Redis</a></li></ul></ul>

<ul><li><a href="#limitations" target="_blank">Limitations</a></li><li><a href="#roadmap" target="_blank">Roadmap</a></li><li><a href="#contributing" target="_blank">Contributing</a></li><li><a href="#license" target="_blank">License</a></li></ul>

<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>

<p>Add the shard to your dependencies:</p>

<pre><code class="language-sh">dependencies:
  motion:
    github: andrewc910/motion.cr
    version: 0.2.0</code></pre>

<p>Create a file <code>motion.cr</code> in <code>config/initializers</code> and add:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;motion&quot;</span>
<span class="c"># Adds a few helper methods</span>
<span class="k">require</span> <span class="s">&quot;motion/monkey_patch/amber&quot;</span></code></pre>

<p>Create a socket:</p>

<pre><code class="language-sh">amber g socket Motion</code></pre>

<p>Add the route:</p>

<pre><code class="language-crystal">websocket <span class="s">&quot;/cable&quot;</span>, <span class="t">MotionSocket</span></code></pre>

<h2><a id="documentation" class="anchor" href="#documentation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Documentation</h2>

<ul><li><a href="https://andrewc910.github.io/motion.cr/" target="_blank">API Documentation</a></li></ul>

<h2><a id="component-guide" class="anchor" href="#component-guide">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Component Guide</h2>

<p>MotionComponents are Crystal objects that output HTML. MotionComponents are most effective in cases where view code is reused or benefits from being tested directly. The code itself was pulled & altered from <a href="https://github.com/luckyframework/lucky" target="_blank">Lucky Framework</a>.</p>

<h3><a id="why-should-i-use-components" class="anchor" href="#why-should-i-use-components">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Why should I use components?</h3>

<h4><a id="testing" class="anchor" href="#testing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Testing</h4>

<p>Unlike traditional views, Motion Components can be unit-tested.</p>

<p>Views are typically tested with slow integration tests that also exercise the routing and controller layers in addition to the view. This cost often discourages thorough test coverage.</p>

<p>With MotionComponents, integration tests can be reserved for end-to-end assertions, with permutations and corner cases covered at the unit level.</p>

<h4><a id="data-flow" class="anchor" href="#data-flow">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Data Flow</h4>

<p>Traditional views have an implicit interface, making it hard to reason about what information is needed to render, leading to subtle bugs when rendering the same view in different contexts.</p>

<p>MotionComponents use defined props that clearly defines what is needed to render, making them easier (and safer) to reuse than partials.</p>

<h4><a id="standards" class="anchor" href="#standards">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Standards</h4>

<p>Views often fail basic code quality standards: long methods, deep conditional nesting, and mystery guests abound.</p>

<p>MotionComponents are Crystal objects, making it easy to follow (and enforce) code quality standards.</p>

<h3><a id="building-components" class="anchor" href="#building-components">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Building components</h3>

<h4><a id="conventions" class="anchor" href="#conventions">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Conventions</h4>

<p>Components are subclasses of <code><a href="Motion/Base.html">Motion::Base</a></code> and live in <code>views/components</code>. It's common practice to create and inherit from an <code>ApplicationComponent</code> that is a subclass of <code><a href="Motion/Base.html">Motion::Base</a></code>. By doing so, not only can you share logic, you can share view templates.</p>

<p>Component names end in <code>Component</code>.</p>

<p>Component module names are plural, as for controllers and jobs: <code>Users::AvatarComponent</code></p>

<h4><a id="quick-start" class="anchor" href="#quick-start">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Quick start</h4>

<p>If you followed the installation guide above, you can start with you first component.</p>

<ol><li>Create a <code>components</code> folder in <code>views</code></li><li>Create your first component:</li></ol>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">MyFirstComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  <span class="k">def</span> <span class="m">render</span>
    html_doctype
    head <span class="k">do</span>
      css_link <span class="s">&quot;/css/main.css&quot;</span>
      utf8_charset
      meta content: <span class="s">&quot;text/html;charset=utf-8&quot;</span>, http_equiv: <span class="s">&quot;Content-Type&quot;</span>
      title <span class="s">&quot;My First Component&quot;</span>
    <span class="k">end</span>

    body <span class="k">do</span>
      h1 { <span class="s">&quot;My First Component!&quot;</span> }
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<ol><li>Render it in your controller:</li></ol>

<pre><code class="language-crystal">render <span class="t">MyFirstComponent</span></code></pre>

<h4><a id="dsl-html-generation" class="anchor" href="#dsl-html-generation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>DSL HTML Generation</h4>

<p>For static html rendering, please review the <a href="https://www.luckyframework.org/guides/frontend/rendering-html#layouts" target="_blank">lucky framework documentation</a></p>

<blockquote>Note: Lucky uses the macro keyword <code>needs</code>, motion uses <code>props</code></blockquote>

<h4><a id="ecr-slang" class="anchor" href="#ecr-slang">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>ECR & Slang</h4>

<p>You can render html templates if you prefer. You have to mix in the amber module in to the components you would like to render from.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">MyFirstComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  <span class="k">include</span> <span class="t">Amber</span><span class="t">::</span><span class="t">Controller</span><span class="t">::</span><span class="t">Helpers</span><span class="t">::</span><span class="t">Render</span>

  <span class="k">def</span> <span class="m">render</span>
    render(<span class="s">&quot;users/new.ecr&quot;</span>, layout: <span class="n">false</span>)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>In your controller:</p>

<pre><code class="language-crystal">render(<span class="t">MyFirstComponent</span>)</code></pre>

<h4><a id="properties-props-type-safety" class="anchor" href="#properties-props-type-safety">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Properties, Props & Type Safety</h4>

<p>Props allow you to pass arguements to child components that are type safe. One of the problems with ecr views & partials is, it's hard to reason what variables & data the page requires to render because everything is within scope. Props explicity display what is required for a particular component.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">MyFirstComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  getter title : <span class="t">String</span>

  <span class="k">def</span> <span class="m">initialize</span>(@title); <span class="k">end</span>

  <span class="k">def</span> <span class="m">render</span>
    html_doctype
    head <span class="k">do</span>
      css_link <span class="s">&quot;/css/main.css&quot;</span>
      utf8_charset
      meta content: <span class="s">&quot;text/html;charset=utf-8&quot;</span>, http_equiv: <span class="s">&quot;Content-Type&quot;</span>
      title <span class="s">&quot;My First Component&quot;</span>
    <span class="k">end</span>

    body <span class="k">do</span>
      h1 { @title }
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Or you can use the <code>props</code> keyword:</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">MyFirstComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  props title : <span class="t">String</span>

  <span class="k">def</span> <span class="m">render</span>
    html_doctype
    head <span class="k">do</span>
      css_link <span class="s">&quot;/css/main.css&quot;</span>
      utf8_charset
      meta content: <span class="s">&quot;text/html;charset=utf-8&quot;</span>, http_equiv: <span class="s">&quot;Content-Type&quot;</span>
      title <span class="s">&quot;My First Component&quot;</span>
    <span class="k">end</span>

    body <span class="k">do</span>
      h1 { @title }
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>In your controller:</p>

<pre><code class="language-crystal">render(<span class="t">MyFirstComponent</span>, title: <span class="s">&quot;Hello World&quot;</span>)</code></pre>

<p>or rendering from a component:</p>

<pre><code class="language-crystal">m(<span class="t">MyFirstComponent</span>, title: <span class="s">&quot;Hello World&quot;</span>) <span class="c"># m is shorthand for mount. mount is also acceptable</span></code></pre>

<p>The if you use the props keyword, do not define an initialize method as it will do it for you. I recommend using the props macro when starting off and switching over to a custom initialization method when you need custom logic.</p>

<h4><a id="blocks-procs" class="anchor" href="#blocks-procs">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Blocks & Procs</h4>

<p>Blocks & Procs can be passed to child components. This will allow you to create more generic & reusable components.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">MyFirstComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  props title : <span class="t">Proc</span>(void)

  <span class="k">def</span> <span class="m">render</span>
    html_doctype
    head <span class="k">do</span>
      css_link <span class="s">&quot;/css/main.css&quot;</span>
      utf8_charset
      meta content: <span class="s">&quot;text/html;charset=utf-8&quot;</span>, http_equiv: <span class="s">&quot;Content-Type&quot;</span>
      title <span class="s">&quot;My First Component&quot;</span>
    <span class="k">end</span>

    body <span class="k">do</span>
      title.call
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>In your parent component:</p>

<pre><code class="language-crystal">title <span class="o">=</span> <span class="t">Proc</span>(void).<span class="k">new</span> { h1 <span class="s">&quot;Hello World!&quot;</span> }
m(<span class="t">MyFirstComponent</span>, title: title)</code></pre>

<h2><a id="motions-guide" class="anchor" href="#motions-guide">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Motions Guide</h2>

<p>Motion.cr allows you to mount special DOM elements that can be updated real-time from frontend interactions, backend state changes, or a combination of both. Some features include:</p>

<ul><li><strong>Websockets Communication</strong> - Communication with your Amber backend is performed via websockets</li><li><strong>No Full Page Reload</strong> - The current page for a user is updated in place.</li><li><strong>Fast DOM Diffing</strong> - DOM diffing is performed when replacing existing content with new content.</li><li><strong>Server Triggered Events</strong> - Server-side events can trigger updates to arbitrarily many components via WebSocket channels.</li></ul>

<p>Motion.cr is similar to <a href="https://github.com/phoenixframework/phoenix_live_view" target="_blank">Phoenix LiveView</a> (and even React!) in some key ways:</p>

<ul><li><strong>Partial Page Replacement</strong> - Motion.cr does not use full page replacement, but rather replaces only the component on the page with new HTML, DOM diffed for performance.</li><li><strong>Encapsulated, consistent stateful components</strong> - Components have continuous internal state that persists and updates. This means each time a component changes, new rendered HTML is generated and can replace what was there before.</li><li><strong>Blazing Fast</strong> - Communication does not have to go through the full Amber router and controller stack. No changes to your routing or controller are required to get the full functionality of Motion.cr.</li></ul>

<h3><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h3>

<pre><code class="language-sh">npm i @awcrotwell/motion</code></pre>

<p>In <code>main.js</code> add:</p>

<pre><code class="language-js">import { createClient } from '@awcrotwell/motion';

const client = createClient();</code></pre>

<h3><a id="building-motions" class="anchor" href="#building-motions">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Building Motions</h3>

<h4><a id="frontend-interactions" class="anchor" href="#frontend-interactions">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Frontend interactions</h4>

<p>Frontend interactions can update your MotionComponents using standard JavaScript events that you're already familiar with: <code>change</code>, <code>blur</code>, form submission, and more. Motions default to click events however you can override this to make it any event you would like. You can invoke motions manually using JavaScript if you need to.</p>

<p>The primary way to handle user interactions on the frontend is by setting <code>motion_component</code> to <code>true</code> annotating <code>@[<a href="Motion/MapMethod.html">Motion::MapMethod</a>]</code> any motion methods:</p>

<pre><code class="language-crystal"><span class="c"># Whenever a user click with the portion of the</span>
<span class="c"># page that contains this component,</span>
<span class="c"># `add` will be invoked, the component will be rerendered</span>
<span class="c"># and the dom will be updated with the new html</span>
<span class="k">class</span> <span class="t">MyMotionComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  <span class="c"># Let motion know this is a motion component</span>
  props motion_component <span class="o">=</span> <span class="n">true</span>
  <span class="c"># Add your props that you plan to pass in or default</span>
  props total : <span class="t">Int32</span> <span class="o">=</span> <span class="n">0</span>

  <span class="c"># Annotate any motion methods</span>
  @[<span class="t">Motion</span><span class="t">::</span><span class="t">MapMethod</span>]
  <span class="k">def</span> <span class="m">add</span>
    @total += <span class="n">1</span>
  <span class="k">end</span>

  <span class="c"># render is what motion will invoke</span>
  <span class="c"># to generate your components html</span>
  <span class="k">def</span> <span class="m">render</span>
    <span class="c"># data_motion: add tells the motion JS library what method</span>
    <span class="c"># to invoke when a user interacts with this component</span>
    div <span class="k">do</span>
      span <span class="k">do</span>
        @total
        button data_motion: <span class="s">&quot;add&quot;</span> <span class="k">do</span> <span class="c"># data_motion: &quot;add&quot; defaults to a click event</span>
                                     <span class="c"># data_motion: &quot;mouseover-&gt;add&quot; to make it a mouseover event</span>
                                     <span class="c"># data_motion: &quot;mouseover-&gt;add mouseout-&gt;add&quot; to map multiple events to a single element</span>
          <span class="s">&quot;Increment&quot;</span> <span class="c"># button text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">MyFirstComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  <span class="k">def</span> <span class="m">render</span>
    html_doctype
    head <span class="k">do</span>
      css_link <span class="s">&quot;/css/main.css&quot;</span>
      utf8_charset
      meta content: <span class="s">&quot;text/html;charset=utf-8&quot;</span>, http_equiv: <span class="s">&quot;Content-Type&quot;</span>
      title <span class="s">&quot;My First Component&quot;</span>
    <span class="k">end</span>

    body <span class="k">do</span>
      m(<span class="t">MyFirstMotionComponent</span>)
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This component can be rendered from your controller:</p>

<pre><code class="language-crystal">render <span class="t">MyFirstComponent</span></code></pre>

<p>Every time the "Increment" button is clicked, MyComponent will call the <code>add</code> method, re-render your component and send it back to the frontend to replace the existing DOM. All invocations of mapped motions will cause the component to re-render, and unchanged rendered HTML will not perform any changes.</p>

<h4><a id="periodic-timers" class="anchor" href="#periodic-timers">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Periodic Timers</h4>

<p>Motion can automatically invoke a method on your component at regular intervals:</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">TickerComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  props ticker : <span class="t">Int32</span> <span class="o">=</span> <span class="n">0</span>
  props motion_component : <span class="t">Bool</span> <span class="o">=</span> <span class="n">true</span>

  @[<span class="t">Motion</span><span class="t">::</span><span class="t">PeriodicTimer</span>(interval: <span class="n">1</span>.second)]
  <span class="k">def</span> <span class="m">tick</span>
    @ticker += <span class="n">1</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">render</span>
    div <span class="k">do</span>
      span @ticker.to_s
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>In this example, after the component has mounted to a websockets channel, <code>tick</code> will be invoked every second and the component will be rerendered on the frontend.</p>

<h4><a id="backend-interactions" class="anchor" href="#backend-interactions">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Backend Interactions</h4>

<p>Backend changes can be streamed to your Motion components in 2 steps.</p>

<ol><li>Broadcast changes after an event you care about:</li></ol>

<pre><code class="language-crystal"><span class="c"># Examples are with Granite ORM but Jennifer ORM works as well</span>
<span class="k">class</span> <span class="t">Todo</span> <span class="o">&lt;</span> <span class="t">Granite</span><span class="t">::</span><span class="t">Base</span>
  after_create <span class="n">:broadcast_created</span>

  <span class="k">def</span> <span class="m">broadcast_created</span>
    <span class="c"># Invoke `stream` on the socket motion connects through</span>
    <span class="t">MotionSocket</span>.stream(<span class="s">&quot;todos:created&quot;</span>)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<ol><li>Configure your Motion component to listen to a channel:</li></ol>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">TodosComponent</span> <span class="o">&lt;</span> <span class="t">Motion</span><span class="t">::</span><span class="t">Base</span>
  props todos : <span class="t">Array</span>(<span class="t">Todo</span>) <span class="o">=</span> <span class="t">Todo</span>.order(created_at: <span class="n">:desc</span>).limit(<span class="n">10</span>)
  <span class="c"># `stream_from` takes 2 arguements</span>
  <span class="c"># the first is the channel we want to listen for</span>
  <span class="c"># the second is a callback method</span>
  stream_from <span class="s">&quot;todos:created&quot;</span>, <span class="s">&quot;handle_created&quot;</span>

  <span class="c"># Callback which will be invoked before rendering</span>
  <span class="k">def</span> <span class="m">handle_created</span>(name)
    <span class="t">Log</span>.info { <span class="s">&quot;I am a callback&quot;</span> }
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This will cause any user that has a page open with <code>TodosComponent</code> mounted on it to re-render that component's portion of the page when a new <code>Todo</code> is created.</p>

<h4><a id="motionevent-and-motionelement" class="anchor" href="#motionevent-and-motionelement">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Motion::Event and Motion::Element</h4>

<p>Methods that are mapped using <code>@[<a href="Motion/MapMethod.html">Motion::MapMethod</a>]</code> can choose to accept an <code>event</code> parameter which is a <code><a href="Motion/Event.html">Motion::Event</a></code>. This object has a <code>target</code> attribute which is a <code><a href="Motion/Element.html">Motion::Element</a></code>, the element in the DOM that triggered the motion. Useful state and attributes can be extracted from these objects, including value, selected, checked, form state, data attributes, and more.</p>

<pre><code class="language-crystal">  @[<span class="t">Motion</span><span class="t">::</span><span class="t">MapMethod</span>]
  <span class="k">def</span> <span class="m">example</span>(event)
    event.<span class="k">type</span> <span class="c"># =&gt; &quot;change&quot;</span>
    event.name <span class="c"># alias for type</span>

    <span class="c"># Motion::Element instance, the element that received the event.</span>
    event.target

    <span class="c"># Motion::Element instance, the element with the event handler and the `data-motion` attribute</span>
    element <span class="o">=</span> event.current_target
    <span class="c"># Alias for #current_target</span>
    event.element


    <span class="c"># Element API examples</span>
    element.tag_name <span class="c"># =&gt; &quot;input&quot;</span>
    element.value <span class="c"># =&gt; &quot;5&quot;</span>
    element.attributes <span class="c"># { class: &quot;col-xs-12&quot;, ... }</span>

    <span class="c"># DOM element with aria-label=&quot;...&quot;</span>
    element[<span class="n">:aria_label</span>]

    <span class="c"># DOM element with data-extra-info=&quot;...&quot;</span>
    element.data[<span class="n">:extra_info</span>]

    <span class="c"># ActionController::Parameters instance with all form params. Also</span>
    <span class="c"># available on Motion::Event objects for convenience.</span>
    element.form_data
  <span class="k">end</span></code></pre>

<p>See the code for full API for <a href="https://andrewc910.github.io/motion.cr/Motion/Event.html" target="_blank">Event</a> and <a href="https://andrewc910.github.io/motion.cr/Motion/Element.html" target="_blank">Element</a>.</p>

<h2><a id="configuration" class="anchor" href="#configuration">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Configuration</h2>

<p>In your <code>motion.cr</code> initializer, you can configure motion.</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;motion&quot;</span>
<span class="k">require</span> <span class="s">&quot;motion/monkey_patch/amber&quot;</span>

<span class="t">Motion</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  <span class="c"># If true, 2 comments will be added at rendering signifying</span>
  <span class="c"># the start &amp; end of a component. Really helpful for debugging.</span>
  <span class="c">#</span>
  <span class="c"># Defaults to true</span>
  config.render_component_comments <span class="o">=</span> <span class="n">true</span>
<span class="k">end</span></code></pre>

<h3><a id="redis-backend-for-distributed-systems" class="anchor" href="#redis-backend-for-distributed-systems">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Redis Backend for Distributed Systems</h3>

<p>By default, MotionComponents are serialized and stored on the server in a json format after a websockets channel has been instaniated. This would break on distributed systems as one server may process a motion but isn't storing the serialized object. Motion.cr supports storing serialized components in redis. </p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;motion&quot;</span>
<span class="k">require</span> <span class="s">&quot;motion/monkey_patch/amber&quot;</span>

<span class="t">Motion</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  <span class="c"># Set the adapter for where deserialized components are stored.</span>
    <span class="c"># Accepts either `:server` or `:redis`. If set to `:server`</span>
    <span class="c"># component connections will be stored in memory on the server.</span>
    <span class="c"># `:redis` requires you to set the `redis_url`.</span>
    config.adapter <span class="o">=</span> <span class="n">:redis</span>

    <span class="c"># Set the redis url if you are using the redis adapter</span>
    <span class="c">#</span>
    <span class="c"># Defaults to `&quot;redis://localhost:6379/0&quot;`</span>
    config.redis_url <span class="o">=</span> <span class="s">&quot;redis://localhost:6379/0&quot;</span>

    <span class="c"># Set the TTL property for components in minutes.</span>
    <span class="c">#</span>
    <span class="c"># Motion removes components after a page offloads, however</span>
    <span class="c"># it is best to set a ttl in case any components do not get</span>
    <span class="c"># offloaded.</span>
    config.redis_ttl <span class="o">=</span> <span class="n">30</span>
<span class="k">end</span></code></pre>

<h2><a id="limitations" class="anchor" href="#limitations">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Limitations</h2>

<ul><li>Due to the way that your components are replaced on the page, Components that set <code>motion_component</code> to <code>true</code> are limited to a single top-level DOM element. If you have multiple DOM elements in your template at the top level, you must wrap them in a single element. This is a similar limitation that React enforced until <code>React.Fragment</code> appeared and is for a very similar reason. Because of this, your upper most component (the component you call from the controller) cannot be a set <code>motion_component</code>. The top most component will return the entire html document to the controller and there is no way to wrap an entire document in a single tag.</li></ul>

<ul><li>Components that enable motions (<code>motion_component = true</code>) cannot accept <code>Proc</code>'s as they cannot be serialized to JSON.  I am actively looking for workarounds however I have no idea if a solution will be found. </li></ul>

<h2><a id="roadmap" class="anchor" href="#roadmap">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Roadmap</h2>

<ul><li>Distributed system support</li><li>Sending only the new html down the wire opposed the entire component</li><li>Global key/value store</li><li>Routing for a full SPA experience? (TBD)</li></ul>

<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at https://github.com/andrewc910/motion.cr/issues.</p>

<h2><a id="license" class="anchor" href="#license">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>License</h2>

<p>The shard is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a>.</p>
</div>
</body>
</html>
